# 管理后台

[TOC]
## 修订记录
----

日期 | 作者 | 修订类型 | 修订内容 | 版本
---- | ---- | ---- | ---- | ---- |
2019年10月21日|冷立纲|A|新增设计方案|1.0

> 【修订类型：A-新增  M-修改 D-删除】

## 背景

系统管理相关接口

## 产品说明


## 关键流程说明

## 接口说明


### 通用接口

-------




### 管理权限

-------


####  登录验证码接口

##### 请求说明

| http 请求方式          |post             |
|:------------- |:---------------:|
| url      |/admin/auth/login_code |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| mobile   | 是 | string  |  登陆手机号 |  |


#####  返回实例

```

{
    "c": 0,
    "m": null,
    "d": {
        "smscode": "835898"  //测试环境返回验证码，线上发送短信验证码
    }
}


```

#####  错误实例


登录失败

```

{
    "c": 20023,
    "m": "一分钟只能发送一次短信",
    "d": null
}


```

####  登陆接口

##### 请求说明

| http 请求方式          | post   json           |
|:------------- |:---------------:|
| url      |/admin/login |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| mobile   | 是 | string  |  登陆手机号 |  |
| password   | 是 | string  |  登陆密码 |  |


##### 请求实例

```json

{
    "username":"15201008961",
    "password":"123456"
}

```


#####  返回实例

```

{
    "c": 0,
    "m": null,
    "d": {
        "adminInfo": {
            "nickName": "xiaogang",
            "avatar": null
        }
    }
}

```


####  账号管理（列表）

##### 请求说明

| http 请求方式          |get             |
|:------------- |:---------------:|
| url      |/admin/admin/list |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| username   | 否 | string  |  姓名 |  |
| page   | 否 | int  |  分页 |  |
| limit   | 否 | int  |  单页条数 |  |


#####  返回实例

```
{
    "c": 0,
    "m": null,
    "d": {
        "pageSize": 10,
        "total": 2,
        "currentPage": 1,
        "list": [
            {
                "id": 3,
                "username": "xiaogang",
                "gender": null,
                "mobile": "15201008962",
                "password": "ae0a6d32ca6657556b2db2f876c9457d",
                "belongTo": null,
                "status": null,
                "privilege": null,
                "type": 0,
                "addTime": 1593442945017,
                "updateTime": 1593443991022,
                "roleIds": [
                    2
                ],
                "avatar": null,
                "lastLoginIp": null,
                "lastLoginTime": null,
                "deleted": false
            }
        ],
        "end": true,
        "empty": false,
        "startIndex": 0,
        "totalPage": 1
    }
}

```


####  账号员详情

##### 请求说明

| http 请求方式          |get             |
|:------------- |:---------------:|
| url      |/admin/admin/read |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| id   | 是 | int  |  管理员Id |  |


#####  返回实例

```

{
    "c": 0,
    "m": null,
    "d": {
        "id": 2,
        "username": "xiaogang",
        "gender": 1,
        "mobile": "15201008961",
        "password": null,
        "belongTo": null,
        "status": 1,
        "privilege": null,
        "type": 1,
        "addTime": null,
        "updateTime": null,
        "roleIds": null,
        "avatar": null,
        "lastLoginIp": null,
        "lastLoginTime": null,
        "deleted": false
    }
}

```


####  添加管理员

##### 请求说明

| http 请求方式          |post   json          |
|:------------- |:---------------:|
| url      |/admin/admin/create |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| username   | 是 | string  |  姓名  |  真实姓名 |
| gender   | 是 | int  |  性别  |   -1 女  1 男 0 未知 |
| mobile   | 是 | string  |  手机号 ||
| password   | 是 | string  |  密码 ||
| status   | 是 | int  |  状态 | 1  正常 -1 禁止登陆 |
| roleIds   | 是 | int[]  |  角色ID |  |
| email   | 否 | string  |  邮箱地址 |  |

	


#####  返回实例

```

{
    "c": 0,
    "m": null,
    "d": {
              
     }
}


```


####  更新管理员

##### 请求说明

| http 请求方式          |post   json          |
|:------------- |:---------------:|
| url      |/admin/admin/update |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| id   | 否 | int  |  管理员Id |   有更新否则添加 |
| username   | 是 | string  |  姓名  |  真实姓名 |
| gender   | 是 | int  |  性别  |   -1 女  1 男 0 未知 |
| mobile   | 是 | string  |  手机号 ||
| password   | 是 | string  |  密码 ||
| status   | 是 | int  |  状态 | 1  正常 -1 禁止登陆 |
| roleIds   | 是 | int[]  |  角色ID |  |
| email   | 否 | string  |  邮箱地址 |  |

	


#####  返回实例

```

{
    "c": 0,
    "m": null,
    "d": {
              
     }
}


```



####  添加角色

##### 请求说明

| http 请求方式          |post    json         |
|:------------- |:---------------:|
| url      |/admin/role/add |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| id   | 否 | int  |  管理员Id |   有更新否则添加 |
| name   | 是 | string  |  角色名称  | |
| resources   | 否 | int[]  | 分配权限数组ID列表  | |

	


#####  返回实例

```

{
    "c": 0,
    "m": null,
    "d": {
              
     }
}


```




#### 角色权限

##### 请求说明

| http 请求方式          |get   |
|:------------- |:---------------:|
| url      |/admin/role/permissions |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| roleId   | 是 | int  | 角色ID  | |

	


#####  返回实例

```

{
    "c": 0,
    "m": null,
    "d": {
        "systemPermissions": [ //权限列表
            {
                "id": 1, //权限ID
                "label": "系统管理:管理员管理:编辑", //标签
                "api": "POST /admin/update", 
                "children": null //子菜单
            }
        ],
        "assignedPermissions": [
            1,2,3,4
        ]  //分配的权限ID
    }
}

```



#### 更新权限

##### 请求说明

| http 请求方式          |post json   |
|:------------- |:---------------:|
| url      |/admin/role/permissions |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| roleId   | 是 | int  | 角色ID   | |
| permissions   | 是 | [] int  |   | |



#####  请求实例

```json

{
    "roleId":1,
    "permissions":[1,2,3,34]
}

```
	


#####  返回实例

```

{
    "c": 0,
    "m": null,
    "d": {
        "systemPermissions": [ //权限列表
            {
                "id": 1, //权限ID
                "label": "系统管理:管理员管理:编辑", //标签
                "api": "POST /admin/update", 
                "children": null //子菜单
            }
        ],
        "assignedPermissions": [
            1,2,3,4
        ]  //分配的权限ID
    }
}

```



####  分页拉取角色列表

##### 请求说明

| http 请求方式          |post             |
|:------------- |:---------------:|
| url      |/admin/role/list |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| limit   | 否 | int  |  单页条数 |   |
| page   | 否 | int  |  当前页码  | |


	


#####  返回实例

```

{
    "c": 0,
    "m": null,
    "d": {
        "pageSize": 10,   //分页相关
        "totalCount": 1,
        "currentPage": 1,
        "unit": "条",
        "extInfo": null,
        "result": [
            {
                "id": 2, //角色ID
                "name": "测试",//角色名称
                "privilege": [ //权限数组
                    7
                ],
                "createTime": null //创建时间
            }
        ],
        "endIndex": 10,
        "startIndex": 0,
        "firstPage": true,
        "lastPage": true,
        "nextPage": 1,
        "previousPage": 1,
        "pageCount": 1
    }
}


```


####  获取角色详情

##### 请求说明

| http 请求方式          |get             |
|:------------- |:---------------:|
| url      |/admin/role/read |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| id   | 是 | int  |  角色ID |   |



	


#####  返回实例

```    

{
    "c": 0,
    "m": null,
    "d": {
        "id": 2,
        "name": "测试", //角色名称
        "privilege": [ //角色权限
            7
        ],
        "createTime": null
    }
}


```



####  删除角色

##### 请求说明

| http 请求方式          |get             |
|:------------- |:---------------:|
| url      | /admin/role/del |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| id   | 是 | int  |  角色ID |   |



	


#####  返回实例

```    

{
    "c": 0,
    "m": null,
    "d": {
       
    }
}


```



####  资源列表

##### 请求说明

| http 请求方式          |get             |
|:------------- |:---------------:|
| url      |/resources/list |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| page   | 否 | int  |  分页号 |    |
| limit   | fou | int  |  单页条数 | |

	


#####  返回实例

```

{
    "c": 0,
    "m": null,
    "d": {
        "pageSize": 10,
        "totalCount": 10,
        "currentPage": 1,
        "unit": "条",
        "extInfo": null,
        "startIndex": 0,
        "firstPage": true,
        "lastPage": true,
        "nextPage": 1,
        "previousPage": 1,
        "pageCount": 1,
        "result": [
            {
                "id": 38, //id
                "title": "删除角色",  //标题
                "path": "/role/del",// url
                "parentId": 29, //父节点ID
                "type": 0, // 类型 0 普通
                "isMenu": 0, //是否菜单项  0 否 1 是
                "createTime": 1577196434017, //创建时间
                "privilegePos": 0, //权限位  非手填值
                "privilegeVal": 512, //权限值 非手填值
                "needAuth": 1 //是否需要权限校验  0 否 1 是
            }
        ],
        "endIndex": 10
    }
}


```



####  添加资源

##### 请求说明

| http 请求方式          |post             |
|:------------- |:---------------:|
| url      |/admin/resources/add |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| title   | 是 | string  |  标题 |   |
| path   | 是 | string  |  访问路径  | |
| parentId   | 是 | int  |  父节点ID  | |
| type   | 是 | int  |   类型 0 普通 | |
| isMenu   | 否 | int  |   是否菜单 0 否 1 是 | |
| needAuth   | 否 | int  |   是否需要权限 0 否 1 是 | |


	


#####  返回实例

```

{
    "c": 0,
    "m": null,
    "d": {
 
 
 	
 	}

}


```


####  获取资源详情

##### 请求说明

| http 请求方式          |get             |
|:------------- |:---------------:|
| url      |/admin/resources/get |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| id   | 是 | int  |  权限ID |   |



	


#####  返回实例

```    

{
    "c": 0,
    "m": null,
    "d": {
        "id": 38, //id
        "title": "删除角色",  //标题
        "path": "/role/del",// url
        "parentId": 29, //父节点ID
        "type": 0, // 类型 0 普通
        "isMenu": 0, //是否菜单项  0 否 1 是
        "createTime": 1577196434017, //创建时间
        "privilegePos": 0, //权限位  非手填值
        "privilegeVal": 512, //权限值 非手填值
        "needAuth": 1 //是否需要权限校验  0 否 1 是
    }
}


```



####  删除资源

##### 请求说明

| http 请求方式          |get             |
|:------------- |:---------------:|
| url      | /admin/resources/del |


#####  输入参数

| 参数          |必选             | 类型       | 参数说明        | 备注          |
|:-------------|:---------------:|:-------------|:-------------|:-------------|
| id   | 是 | int  |  权限ID |   |



	


#####  返回实例

```    

{
    "c": 0,
    "m": null,
    "d": {
       
    }
}


```
